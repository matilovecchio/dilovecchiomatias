@use "../base/variables" as *;
@use "../base/mixins" as *;

/* ========== PROJECTS ========== */
#projects {
  /* Colores y medidas locales para esta sección */
  --ink: #{$color-bg-dark};
  --bg: #{$color-text-light};
  --stroke: #{$border-w};
  --card-max: 1039px;
  --gap: #{$space-24};
  --meta-w: 280px;
  --marquee-speed: 45s;
  --marquee-gap: #{$space-24};
  --tilt-bleed: 60px;

  /* Colores de hover por tipo de elemento */
  --hover-label: #{$accent-lime};
  --hover-date: #{$accent-purple};
  --hover-desc: #{$accent-cyan};
  --hover-btn: #{$accent-green};

  position: relative;
  background: var(--bg);
  font-family: $ff-base;
  color: var(--ink);
  /* Padding vertical */
  padding-block: calc(clamp(16px, 2.5vw, 32px) + var(--tilt-bleed));
  overflow: visible;

  /* Ajuste de padding lateral */
  &:is(section).container-fluid {
    padding-left: $space-48 !important;
    padding-right: $space-48 !important;
  }

  /* ===== Cabecera (título + texto) ===== */
  .section-title {
    display: inline-block;
    background: var(--ink);
    color: var(--bg);
    margin-bottom: 0;
    padding: $space-8;
  }

  .section-head {
    display: flex;
    align-items: center;
    gap: 0;
    margin-bottom: $space-16;
    width: 100%;

    .desc-rail {
      flex: 1 1 auto;
      min-width: 0;
      border: var(--stroke) solid var(--ink);
      background: var(--bg);
      padding: $space-16 $space-24;

      .section-desc {
        margin: 0;
        font-weight: 400;
        font-size: 32px;
        line-height: 1.2;
        color: var(--ink);
      }
    }
  }

  /* ===== Marquee horizontal de projects ===== */
  .projects-marquee {
    position: relative;
    overflow-x: hidden;
    overflow-y: visible;
    padding-block: $space-16;
    /* Strokes verticales a ambos lados */
    border-left: var(--stroke) solid var(--ink);
    border-right: var(--stroke) solid var(--ink);
    box-sizing: border-box;

    .projects-track {
      display: flex;
      gap: var(--marquee-gap);
      width: max-content;
      align-items: flex-start;
      will-change: transform;
      animation: projects-marquee var(--marquee-speed) linear infinite;
      overflow: visible;
    }
    /* Pausa la animación al hacer hover en el contenedor */
    &:hover .projects-track { animation-play-state: paused; }
  }

  @keyframes projects-marquee {
    from { transform: translateX(calc(-50% - var(--marquee-gap) / 2)); }
    to   { transform: translateX(0); }
  }

  /* ===== Card de proyecto ===== */
  .project-card {
    flex: 0 0 auto;
    width: min(var(--card-max), calc(100vw - 64px));
    background: var(--bg);
    display: grid;
    grid-template-columns: 1fr;
    grid-auto-rows: auto;
    overflow: visible;

    .project-media {
      width: 100%;
      height: clamp(220px, 45vw, 420px);
      object-fit: cover;
      display: block;
      border: var(--stroke) solid var(--ink);
      box-sizing: border-box;
      position: relative;
      z-index: 0;
    }

    .project-data-row {
      display: grid;
      grid-template-columns: var(--meta-w) 1fr auto;
      grid-template-rows: auto auto;
      align-items: start;
      column-gap: 0;
      margin-top: calc(-1 * var(--stroke));
      overflow: visible;
      position: relative;
      z-index: 2;

      /* Columna izquierda con metadatos (nombre/fecha) */
      .meta-col {
        display: grid;
        grid-template-rows: auto auto;
        min-width: var(--meta-w);
        max-width: var(--meta-w);
        overflow: visible;
      }

      /* Bloques interactivos dentro de la fila de datos */
      .name-box,
      .date-box,
      .desc,
      .project-cta {
        position: relative;
        border: var(--stroke) solid var(--ink);
        box-sizing: border-box;
        background: var(--bg);
        @include smooth(transform, .18s, ease);
        @include smooth(background-color, .18s, ease);
        @include smooth(box-shadow, .18s, ease);
        @include smooth(border-color, .18s, ease);
        @include smooth(z-index, .18s, ease);
        overflow: visible;
        transform-origin: center;
      }

      .name-box {
        border-right: none;
        padding: $space-12 $space-16;

        .name {
          margin: 0;
          font-weight: 700;
          font-size: 24px;
          color: var(--ink);
          line-height: 1.15;
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          line-clamp: 2;
          overflow: hidden;
          word-break: break-word;
        }
      }

      .date-box {
        border-right: none;
        margin-top: calc(-1 * var(--stroke));
        padding: $space-12 $space-16;
        font-weight: 400;
        font-size: 24px;
        color: var(--ink);
        white-space: nowrap;
      }

      .desc {
        grid-column: 2;
        grid-row: 1 / span 2;
        padding: $space-16;

        p {
          margin: 0;
          font-weight: 400;
          font-size: 24px;
          line-height: 1.35;
          color: var(--ink);
        }
      }

      .project-cta {
        grid-column: 3;
        grid-row: 1 / span 2;
        border-left: none;
        --size: 110px;
        width: var(--size);
        height: var(--size);
        min-width: var(--size);
        min-height: var(--size);
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        cursor: pointer;

        .icon { width: 44px; height: 44px; display: block; }
        &:focus-visible { outline: 3px dashed var(--ink); outline-offset: 2px; }
      }

      /* ===== Hovers por bloque ===== */
      .name-box:hover {
        transform: rotate(-3deg);
        background: var(--hover-label);
        border-color: transparent;
        box-shadow: 0 0 0 var(--stroke) var(--ink);
        z-index: 10;
      }
      .date-box:hover {
        transform: rotate(-3deg);
        background: var(--hover-date);
        border-color: transparent;
        box-shadow: 0 0 0 var(--stroke) var(--ink);
        z-index: 10;
      }
      .desc:hover {
        transform: rotate(-3deg);
        background: var(--hover-desc);
        z-index: 10;
      }
      .project-cta:hover {
        transform: rotate(-3deg);
        background: var(--hover-btn);
        border-color: transparent;
        box-shadow: 0 0 0 var(--stroke) var(--ink);
        z-index: 10;
      }
    }
  }

  /* ===== Responsive ===== */
  @media (max-width: $bp-md) {
    --tilt-bleed: 64px;

    .project-card { width: calc(100vw - 40px); }
    .project-card .project-media { height: 56vw; }

    .project-card .project-data-row {
      grid-template-columns: 1fr;
      grid-template-rows: auto auto auto auto;
      margin-top: calc(-1 * var(--stroke));

      .meta-col { grid-template-columns: 1fr auto; grid-template-rows: auto; }
      .name-box { border-right: var(--stroke) solid var(--ink); }
      .date-box { border-right: var(--stroke) solid var(--ink); margin-top: 0; }
      .project-cta { border-left: var(--stroke) solid var(--ink); justify-self: start; }
    }

    .section-head { flex-direction: column; gap: $space-12; }
    .section-head .desc-rail { width: 100%; }
  }

  /* ===== Accesibilidad: usuarios que prefieren menos movimiento ===== */
  @media (prefers-reduced-motion: reduce) {
    .projects-marquee .projects-track { animation: none; }
  }
}
